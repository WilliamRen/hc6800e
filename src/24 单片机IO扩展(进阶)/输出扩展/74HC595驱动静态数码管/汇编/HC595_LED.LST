A51 MACRO ASSEMBLER  HC595_LED                                                            11/02/2009 22:20:22 PAGE     1


MACRO ASSEMBLER A51 V7.09
OBJECT MODULE PLACED IN HC595_LED.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE HC595_LED.asm SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     ;/*******************************************************************************
                       2     ;*  标题:           试验74HC595驱动数码管上显示数字（汇编语言）                 *
                       3     ;*                                                                                         
                                                                                              *
                       4     ;*   连接方法：JP12用条线冒短接  JP3和JP2 用8PIN排线连接                                   
                                      *                                                                                                   
                       5     ;********************************************************************************
                       6     ;* 通过本例程了解 74HC595（串入并出）基本原理和使用                                 *
                       7     ;*                                                                                         
                                                          *
                       8     ;* 请学员认真消化本例程，懂74C595在汇编语言中的操作                             *
                       9     ;********************************************************************************/
                      10     
                      11      ;================================================
                      12     
  00B6                13          MOSIO    EQU  P3.6   ;串行数据输入
  00B4                14          S_CLK    EQU  P3.4   ;移位时钟脉冲
  00B5                15          R_CLK    EQU  P3.5   ;输出锁存器控制脉冲
                      16          
                      17     ;================================================
                      18     
0000                  19            ORG  0000H
0000 020030           20            LJMP  INTI
0030                  21            ORG  0030H
                      22     
                      23     ;================================================
0030                  24       INTI:
0030 752000           25             MOV 20H,#00H
0033 E520             26             MOV A,20H
0035                  27       MAIN:
                      28                             
0035 540F             29                 ANL A,#0FH      ;屏蔽累加器的高4位
0037 900100           30                     MOV DPTR,#TAB   ;将数据表格的首地址 0100H存入16位的数据地址指针DPTR中
003A 93               31                     MOVC A,@A+DPTR  ;查表
003B F8               32                     MOV R0,A            
003C 1164             33                     ACALL DELAY         ;调用延时子程序
003E E520             34                     MOV A,20H               ;将20H单元的数据传送给累加器
0040 04               35                     INC A                   ;累加器+1
                      36                ;DA A                        ;二-十进制调整    如果这句使用数码管只显示 0-9
0041 F520             37                     MOV 20H, A                      
0043 114B             38                     CALL OUT_595
0045 1164             39                 CALL  DELAY
0047 E520             40                     MOV  A ,20H
0049 80EA             41                 JMP  MAIN
                      42     ;---------------------------------------------------------------
                      43     ;输出锁存器输出数据子程序
                      44     ;---------------------------------------------------------------
004B                  45     OUT_595:
004B 120055           46             LCALL WR_595
004E C2B5             47             CLR  R_CLK
0050 00               48             NOP                              ;用NOP指令产生方波
0051 00               49             NOP
0052 D2B5             50             SETB R_CLK      ;下降沿将数据送到输出锁存器
0054 22               51             RET
                      52     ;--------------------------------------------------------------
                      53     ;移位寄存器接收数据子程序
                      54     ;--------------------------------------------------------------
0055                  55     WR_595:         
A51 MACRO ASSEMBLER  HC595_LED                                                            11/02/2009 22:20:22 PAGE     2

0055 7C08             56             MOV R4,#08H      ;总共移8次   
0057 E8               57             MOV A,R0
0058                  58     WR_LOOP:        
0058 33               59             RLC A                    ;带进位左移
0059 92B6             60             MOV MOSIO,C         
005B C2B4             61             CLR S_CLK       ;下降沿发生移位
005D 00               62                 NOP
005E 00               63             NOP
005F D2B4             64             SETB S_CLK
0061 DCF5             65             DJNZ R4,WR_LOOP
0063 22               66             RET
                      67     ;--------------------------------------------------------------
                      68     ;延时子程序
                      69     ;--------------------------------------------------------------
0064                  70     DELAY:          
0064 7D10             71                 MOV  R5,#010H
0066                  72     DEL0:         
0066 7EFF             73                 MOV  R6,#0FFH
0068                  74     DEL1:          
0068 7F1F             75                 MOV   R7,#01FH
006A DFFE             76                 DJNZ  R7,$
006C DEFA             77                 DJNZ  R6,DEL1
006E DDF6             78                 DJNZ  R5,DEL0
0070 22               79                 RET
                      80                   
                      81     
0100                  82             ORG 0100H
0100 C0F9A4B0         83     TAB:    DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H         ;LED字模表
0104 999282F8                
0108 80908883         84             DB 80H,90H,88H,83H,0C6H,0A1H,86H,08EH
010C C6A1868E                
                      85             END
                             
                             ;/此表为 LED 的字模            
                             ; 0    1    2    3    4    5    6   7    8    9    A    b    c    d    E    -    L   P    U
                                 Hidden  _ (20)
                             ;{ 0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90,0x88,0x83,0xC6,0xA1,0x86,0xbf,0xc7,0x8
                             c,0xc1, 0xff,  0xf7 }; 
                             
                             
A51 MACRO ASSEMBLER  HC595_LED                                                            11/02/2009 22:20:22 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

DEL0 . . . . . . .  C ADDR   0066H   A   
DEL1 . . . . . . .  C ADDR   0068H   A   
DELAY. . . . . . .  C ADDR   0064H   A   
INTI . . . . . . .  C ADDR   0030H   A   
MAIN . . . . . . .  C ADDR   0035H   A   
MOSIO. . . . . . .  B ADDR   00B0H.6 A   
OUT_595. . . . . .  C ADDR   004BH   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
R_CLK. . . . . . .  B ADDR   00B0H.5 A   
S_CLK. . . . . . .  B ADDR   00B0H.4 A   
TAB. . . . . . . .  C ADDR   0100H   A   
WR_595 . . . . . .  C ADDR   0055H   A   
WR_LOOP. . . . . .  C ADDR   0058H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
